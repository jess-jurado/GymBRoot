<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Detalle del Ejercicio</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
  <div class="ejercicio-container">
    <h1 id="ejercicio-nombre">Nombre del Ejercicio: {{ nombre_ejercicio }}</h1>
    <h2 id="ejercicio-subgrupo">Subgrupo Muscular: {{ subgrupo_muscular }}</h2>
    
    <!-- Imagen del ejercicio -->
    {% if imagen_url %}
      <div class="ejercicio-imagen">
        <img src="{{ imagen_url }}" alt="Imagen del ejercicio" class="img-responsive">
      </div>
    {% else %}
      <p>No hay imagen disponible.</p>
    {% endif %}

    <form id="detalle-ejercicio-form">
      <div class="input-group">
        <label for="series">Número de Series:</label>
        <input type="number" id="series" name="series" placeholder="Ej: 3" min="1" required oninput="generarSeries()">
      </div>

      <div id="series-container">
        <!-- Aquí se agregarán dinámicamente los campos de repeticiones y peso -->
      </div>

      <div class="submit-btn">
        <button type="submit" class="btn">Guardar Ejercicio</button>
      </div>
    </form>

    <button onclick="window.history.back()" class="btn">Volver</button>
  </div>

  <script>
     function generarSeries() {
    const seriesContainer = document.getElementById("series-container");
    const numSeries = parseInt(document.getElementById("series").value) || 0;
    
    seriesContainer.innerHTML = ""; // Limpiar contenido anterior

    for (let i = 1; i <= numSeries; i++) {
      const serieDiv = document.createElement("div");
      serieDiv.classList.add("serie");

      serieDiv.innerHTML = `
        <h3>Serie ${i}</h3>
        <div class="input-group">
          <label for="repeticiones_${i}">Repeticiones:</label>
          <input type="number" id="repeticiones_${i}" name="repeticiones_${i}" placeholder="Ej: 10" min="1" required>
        </div>

        <div class="input-group">
          <label for="peso_${i}">Peso (kg):</label>
          <input type="number" id="peso_${i}" name="peso_${i}" placeholder="Ej: 20" min="0" step="0.1" required>
        </div>
      `;

      seriesContainer.appendChild(serieDiv);
    }
  }

  document.getElementById('detalle-ejercicio-form').addEventListener('submit', function(e) {
    e.preventDefault();

    const numSeries = parseInt(document.getElementById("series").value);
    const ejercicioId = "{{ ejercicio_id }}";  // Verifica que Flask lo está enviando

    if (!ejercicioId) {
      alert("Error: No se encontró el ID del ejercicio.");
      return;
    }

    let datosEjercicio = [];

    for (let i = 1; i <= numSeries; i++) {
      const repeticiones = document.getElementById(`repeticiones_${i}`).value;
      const peso = document.getElementById(`peso_${i}`).value;

      if (!repeticiones || !peso) {
        alert(`Por favor, completa todos los datos de la serie ${i}.`);
        return;
      }

      datosEjercicio.push({ serie: i, repeticiones: repeticiones, peso: peso });
    }

    fetch(`/guardar_series/${ejercicioId}`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ series: datosEjercicio })
    })
    .then(response => response.json())
    .then(data => {
      if (data.error) {
        alert("Error: " + data.error);
      } else {
        alert(data.message);
        window.history.back();  // Volver a la página anterior tras guardar
      }
    })
    .catch(error => console.error("Error al guardar:", error));
});
  </script>
</body>
</html>
